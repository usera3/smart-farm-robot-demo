<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>WebSocket æµ‹è¯•</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #0f0;
            padding: 20px;
        }
        .log {
            background: #000;
            border: 2px solid #0f0;
            padding: 20px;
            margin: 20px 0;
            height: 400px;
            overflow-y: scroll;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #0f0;
            padding-left: 10px;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background: #0ff;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border: 2px solid #0f0;
        }
        .connected { border-color: #0f0; background: #002200; }
        .disconnected { border-color: #f00; background: #220000; color: #f00; }
    </style>
</head>
<body>
    <h1>ğŸ” WebSocket è¿æ¥æµ‹è¯•</h1>
    
    <div id="status" class="status disconnected">
        âŒ WebSocket: æœªè¿æ¥
    </div>
    
    <div>
        <button onclick="testCartUpdate()">æµ‹è¯• cart_update</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <button onclick="location.href='/'">è¿”å›æ¸¸æˆ</button>
    </div>
    
    <h2>äº‹ä»¶æ—¥å¿—:</h2>
    <div id="log" class="log"></div>
    
    <script>
        const socket = io();
        let logCount = 0;
        
        function addLog(message, color = '#0f0') {
            logCount++;
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.style.color = color;
            entry.innerHTML = `[${logCount}] ${new Date().toLocaleTimeString()} - ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            logCount = 0;
        }
        
        function updateStatus(connected) {
            const statusDiv = document.getElementById('status');
            if (connected) {
                statusDiv.className = 'status connected';
                statusDiv.innerHTML = 'âœ… WebSocket: å·²è¿æ¥';
            } else {
                statusDiv.className = 'status disconnected';
                statusDiv.innerHTML = 'âŒ WebSocket: æœªè¿æ¥';
            }
        }
        
        // è¿æ¥äº‹ä»¶
        socket.on('connect', () => {
            addLog('ğŸŸ¢ Socket.IO è¿æ¥æˆåŠŸ!', '#0f0');
            updateStatus(true);
        });
        
        socket.on('disconnect', () => {
            addLog('ğŸ”´ Socket.IO æ–­å¼€è¿æ¥!', '#f00');
            updateStatus(false);
        });
        
        socket.on('connected', (data) => {
            addLog('ğŸŸ¢ æ”¶åˆ° connected äº‹ä»¶', '#0ff');
            addLog('   æ•°æ®: ' + JSON.stringify(data).substring(0, 100), '#888');
        });
        
        // ç›‘å¬ cart_update
        socket.on('cart_update', (data) => {
            addLog('ğŸš— æ”¶åˆ° cart_update äº‹ä»¶!', '#ff0');
            addLog('   ä½ç½®: (' + data.x + ', ' + data.z + ')', '#ff0');
            addLog('   è§’åº¦: ' + data.rotation + 'Â°', '#ff0');
            addLog('   é€Ÿåº¦: ' + data.speed, '#ff0');
        });
        
        // ç›‘å¬å…¶ä»–äº‹ä»¶
        socket.on('laser_fired', (data) => {
            addLog('ğŸ”¥ laser_fired: ' + JSON.stringify(data), '#f0f');
        });
        
        socket.on('auto_farm_task_started', (data) => {
            addLog('ğŸ¤– auto_farm_task_started: ' + JSON.stringify(data), '#0ff');
        });
        
        socket.on('auto_farm_action', (data) => {
            addLog('âš¡ auto_farm_action: ' + JSON.stringify(data), '#0ff');
        });
        
        // æµ‹è¯•å‡½æ•°
        function testCartUpdate() {
            addLog('ğŸ“¤ å‘é€æµ‹è¯•è¯·æ±‚åˆ° /api/cart/update...', '#fff');
            
            fetch('/api/cart/update', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    x: Math.random() * 2 - 1,
                    z: Math.random() * 2 - 1,
                    rotation: Math.random() * 360,
                    speed: 2.0
                })
            })
            .then(response => response.json())
            .then(data => {
                addLog('ğŸ“¥ API å“åº”: ' + JSON.stringify(data), '#0f0');
            })
            .catch(error => {
                addLog('âŒ API é”™è¯¯: ' + error, '#f00');
            });
        }
        
        // åˆå§‹æ—¥å¿—
        addLog('ğŸš€ WebSocket æµ‹è¯•é¡µé¢å·²åŠ è½½', '#fff');
        addLog('ğŸ“¡ æ­£åœ¨è¿æ¥åˆ°æœåŠ¡å™¨...', '#fff');
    </script>
</body>
</html>







