# å¿«é€Ÿå¼€å§‹æŒ‡å— - Winsockè¿œç¨‹æ§åˆ¶ç³»ç»Ÿ

## ğŸš€ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºWinsockçš„æ™ºèƒ½å†œåœºè¿œç¨‹æ§åˆ¶ç³»ç»Ÿï¼Œå°†åŸæœ‰çš„Flask/WebSocketæ¶æ„æ”¹é€ ä¸ºC++ Winsockå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œæ»¡è¶³è¯¾ç¨‹ä½œä¸šè¦æ±‚ã€‚

## ğŸ“‹ å·²å®Œæˆçš„å·¥ä½œ

### âœ… ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒæ¶æ„è®¾è®¡

1. **é€šä¿¡åè®®è®¾è®¡** (`WINSOCK_PROTOCOL.md`)
   - å®šä¹‰äº†å®Œæ•´çš„æ•°æ®åŒ…æ ¼å¼
   - 15ç§å®¢æˆ·ç«¯å‘½ä»¤
   - 8ç§æœåŠ¡å™¨å“åº”
   - 9ç§é”™è¯¯ä»£ç 

2. **æœåŠ¡å™¨ç«¯æ ¸å¿ƒä»£ç ** (`winsock_server/`)
   - `protocol.h/cpp` - åè®®å®ç°
   - `FarmServer.h/cpp` - æœåŠ¡å™¨æ ¸å¿ƒåŠŸèƒ½
   - `main.cpp` - ä¸»ç¨‹åºå…¥å£
   - `CMakeLists.txt` - æ„å»ºé…ç½®

3. **å®¢æˆ·ç«¯æ¡†æ¶** (`winsock_client/`)
   - `FarmClient.h` - å®¢æˆ·ç«¯ç±»å®šä¹‰

4. **æ–‡æ¡£**
   - `WINSOCK_PROTOCOL.md` - åè®®è¯¦ç»†è¯´æ˜
   - `WINSOCK_PROJECT_SUMMARY.md` - é¡¹ç›®æ€»ç»“
   - `winsock_server/README.md` - æœåŠ¡å™¨æ–‡æ¡£

## ğŸ”§ ä¸‹ä¸€æ­¥å·¥ä½œ

### ä¼˜å…ˆçº§1ï¼šå®ŒæˆåŸºç¡€åŠŸèƒ½ï¼ˆå¿…éœ€ï¼‰

#### 1. å®ç°å®¢æˆ·ç«¯ `FarmClient.cpp`

```cpp
// éœ€è¦å®ç°çš„æ ¸å¿ƒæ–¹æ³•ï¼š
bool FarmClient::connectInternal() {
    // åˆ›å»ºsocket
    // è¿æ¥æœåŠ¡å™¨
    // å¯åŠ¨æ¥æ”¶çº¿ç¨‹
}

bool FarmClient::sendPacket(const Packet& packet) {
    // åºåˆ—åŒ–æ•°æ®åŒ…
    // å‘é€åˆ°æœåŠ¡å™¨
}

void FarmClient::receiveLoop() {
    // å¾ªç¯æ¥æ”¶æœåŠ¡å™¨æ¶ˆæ¯
    // è§£æå“åº”
    // è§¦å‘å›è°ƒ
}
```

#### 2. å®ç°Pythoné›†æˆ `PythonBridge.h/cpp`

```cpp
class PythonBridge {
public:
    bool initialize(const std::string& pythonHome);
    std::string callFunction(const std::string& module, 
                            const std::string& function,
                            const std::string& args);
    void shutdown();
};
```

#### 3. åˆ›å»ºç®€å•çš„æµ‹è¯•ç¨‹åº

**æœåŠ¡å™¨æµ‹è¯•** (`test_server.cpp`):
```cpp
int main() {
    FarmServer server;
    ServerConfig config;
    config.port = 8888;
    
    if (server.start(config)) {
        std::cout << "Server running, press Enter to stop..." << std::endl;
        std::cin.get();
        server.stop();
    }
    return 0;
}
```

**å®¢æˆ·ç«¯æµ‹è¯•** (`test_client.cpp`):
```cpp
int main() {
    FarmClient client;
    ClientConfig config;
    config.serverIP = "127.0.0.1";
    config.serverPort = 8888;
    
    if (client.connect(config)) {
        client.sendConnect("TestClient");
        client.sendGetState();
        client.sendMoveCart(1.5, -2.0);
        
        std::this_thread::sleep_for(std::chrono::seconds(5));
        client.disconnect();
    }
    return 0;
}
```

### ä¼˜å…ˆçº§2ï¼šå®ç°GUIç•Œé¢ï¼ˆæ¨èï¼‰

#### é€‰é¡¹Aï¼šä½¿ç”¨MFCï¼ˆWindowsåŸç”Ÿï¼‰

**æœåŠ¡å™¨GUI** - å¯¹è¯æ¡†åº”ç”¨ï¼š
- çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ
- å®¢æˆ·ç«¯åˆ—è¡¨æ§ä»¶ï¼ˆCListCtrlï¼‰
- æ—¥å¿—æ˜¾ç¤ºæ§ä»¶ï¼ˆCListBoxï¼‰
- æ§åˆ¶æŒ‰é’®ï¼ˆå¯åŠ¨/åœæ­¢ï¼‰

**å®¢æˆ·ç«¯GUI** - å¯¹è¯æ¡†åº”ç”¨ï¼š
- è¿æ¥è®¾ç½®ï¼ˆIPã€ç«¯å£ã€è¿æ¥æŒ‰é’®ï¼‰
- æ§åˆ¶é¢æ¿ï¼ˆç§»åŠ¨ã€æ“ä½œæŒ‰é’®ï¼‰
- çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ
- æ¤ç‰©ç½‘æ ¼æ˜¾ç¤º

#### é€‰é¡¹Bï¼šä½¿ç”¨Qtï¼ˆè·¨å¹³å°ï¼‰

```cpp
// ServerWindow.h
class ServerWindow : public QMainWindow {
    Q_OBJECT
public:
    ServerWindow(QWidget* parent = nullptr);
    
private slots:
    void onStartServer();
    void onStopServer();
    void onLogReceived(const QString& log);
    
private:
    QTableWidget* clientTable;
    QTextEdit* logDisplay;
    QPushButton* startButton;
    QPushButton* stopButton;
    FarmServer* server;
};
```

### ä¼˜å…ˆçº§3ï¼šå®Œå–„åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

1. **Pythoné›†æˆæµ‹è¯•**
   - è°ƒç”¨ `plant_manager.py` è·å–æ¤ç‰©ä¿¡æ¯
   - è°ƒç”¨ `auto_farm_controller.py` æ§åˆ¶è‡ªåŠ¨åŒ–

2. **é”™è¯¯å¤„ç†å¢å¼º**
   - ç½‘ç»œå¼‚å¸¸å¤„ç†
   - æ•°æ®éªŒè¯
   - è¶…æ—¶é‡è¯•

3. **æ€§èƒ½ä¼˜åŒ–**
   - æ•°æ®åŒ…å‹ç¼©
   - è¿æ¥æ± ç®¡ç†
   - å†…å­˜ä¼˜åŒ–

## ğŸ› ï¸ ç¼–è¯‘å’Œè¿è¡Œ

### Windows + Visual Studio

#### æ–¹æ³•1ï¼šä½¿ç”¨CMake

```bash
cd winsock_server
mkdir build
cd build
cmake .. -G "Visual Studio 16 2019"
cmake --build . --config Release
```

#### æ–¹æ³•2ï¼šä½¿ç”¨Visual Studioç›´æ¥ç¼–è¯‘

1. æ‰“å¼€Visual Studio 2019/2022
2. åˆ›å»ºæ–°é¡¹ç›®ï¼šC++ æ§åˆ¶å°åº”ç”¨
3. æ·»åŠ æ–‡ä»¶ï¼š
   - `protocol.h/cpp`
   - `FarmServer.h/cpp`
   - `main.cpp`
4. é¡¹ç›®å±æ€§è®¾ç½®ï¼š
   - é“¾æ¥å™¨ â†’ è¾“å…¥ â†’ é™„åŠ ä¾èµ–é¡¹ï¼š`ws2_32.lib`
   - C/C++ â†’ é¢„å¤„ç†å™¨ï¼š`_WINSOCK_DEPRECATED_NO_WARNINGS`
5. ç¼–è¯‘è¿è¡Œï¼ˆF5ï¼‰

### è¿è¡ŒæœåŠ¡å™¨

```bash
# é»˜è®¤é…ç½®è¿è¡Œ
FarmServer.exe

# æŒ‡å®šç«¯å£
FarmServer.exe --port 8888

# ä½¿ç”¨é…ç½®æ–‡ä»¶
FarmServer.exe --config server_config.json

# è°ƒè¯•æ¨¡å¼
FarmServer.exe --debug
```

### è¿è¡Œå®¢æˆ·ç«¯

```bash
# è¿æ¥æœ¬åœ°æœåŠ¡å™¨
FarmClient.exe

# è¿æ¥è¿œç¨‹æœåŠ¡å™¨
FarmClient.exe --server 192.168.1.100 --port 8888
```

## ğŸ“ æµ‹è¯•æ­¥éª¤

### åŸºç¡€é€šä¿¡æµ‹è¯•

1. **å¯åŠ¨æœåŠ¡å™¨**
   ```bash
   cd winsock_server/build/bin
   FarmServer.exe
   ```
   
2. **å¯åŠ¨å®¢æˆ·ç«¯**
   ```bash
   cd winsock_client/build/bin
   FarmClient.exe
   ```

3. **æµ‹è¯•å‘½ä»¤**
   - å®¢æˆ·ç«¯å‘é€è¿æ¥å‘½ä»¤
   - æœåŠ¡å™¨æ˜¾ç¤ºå®¢æˆ·ç«¯è¿æ¥æ—¥å¿—
   - å®¢æˆ·ç«¯å‘é€ç§»åŠ¨å‘½ä»¤
   - æœåŠ¡å™¨å¤„ç†å¹¶å“åº”
   - å®¢æˆ·ç«¯æ¥æ”¶å“åº”å¹¶æ˜¾ç¤º

### å¤šå®¢æˆ·ç«¯æµ‹è¯•

1. å¯åŠ¨1ä¸ªæœåŠ¡å™¨
2. å¯åŠ¨3ä¸ªå®¢æˆ·ç«¯
3. è§‚å¯ŸæœåŠ¡å™¨å®¢æˆ·ç«¯åˆ—è¡¨
4. å„å®¢æˆ·ç«¯å‘é€ä¸åŒå‘½ä»¤
5. éªŒè¯æœåŠ¡å™¨æ­£ç¡®å¤„ç†

### è‡ªåŠ¨åŒ–æµ‹è¯•

1. å®¢æˆ·ç«¯å‘é€ `AUTO_FARM_START`
2. æœåŠ¡å™¨è°ƒç”¨Pythonè‡ªåŠ¨åŒ–æ¨¡å—
3. æœåŠ¡å™¨å®šæœŸæ¨é€è‡ªåŠ¨åŒ–çŠ¶æ€
4. å®¢æˆ·ç«¯æ˜¾ç¤ºè‡ªåŠ¨åŒ–è¿›åº¦

## ğŸ“Š ä½œä¸šæäº¤æ¸…å•

### å¿…éœ€æ–‡ä»¶

- [x] æºä»£ç 
  - [x] æœåŠ¡å™¨ç«¯ä»£ç  (`winsock_server/`)
  - [x] å®¢æˆ·ç«¯ä»£ç  (`winsock_client/`)
  - [ ] GUIç•Œé¢ä»£ç ï¼ˆå¾…å®ç°ï¼‰
  - [x] Pythonä¸šåŠ¡é€»è¾‘ï¼ˆå·²æœ‰ï¼‰

- [ ] å¯æ‰§è¡Œæ–‡ä»¶
  - [ ] `FarmServer.exe`
  - [ ] `FarmClient.exe`

- [x] æ–‡æ¡£
  - [x] é€šä¿¡åè®®è¯´æ˜ (`WINSOCK_PROTOCOL.md`)
  - [x] é¡¹ç›®æ€»ç»“ (`WINSOCK_PROJECT_SUMMARY.md`)
  - [x] æœåŠ¡å™¨æ–‡æ¡£ (`winsock_server/README.md`)
  - [ ] ç”¨æˆ·æ‰‹å†Œï¼ˆå¾…ç¼–å†™ï¼‰

- [ ] æ¼”ç¤ºææ–™
  - [ ] è¿è¡Œæˆªå›¾
  - [ ] æ“ä½œè§†é¢‘
  - [ ] PPTæ¼”ç¤º

### æŠ¥å‘Šç»“æ„å»ºè®®

```
1. åº”ç”¨åœºæ™¯ä»‹ç»
   - æ™ºèƒ½å†œåœºæœºå™¨äººè¿œç¨‹æ§åˆ¶ç³»ç»Ÿ
   - å®é™…åº”ç”¨ä»·å€¼

2. è®¾è®¡æ€è·¯
   - Winsocké€šä¿¡æ¶æ„
   - è‡ªå®šä¹‰åè®®è®¾è®¡
   - å¤šçº¿ç¨‹å¤„ç†æœºåˆ¶

3. æµç¨‹æ¡†å›¾
   - æœåŠ¡å™¨å¯åŠ¨æµç¨‹
   - å®¢æˆ·ç«¯è¿æ¥æµç¨‹
   - å‘½ä»¤å¤„ç†æµç¨‹
   - æ•°æ®åŒ…æ ¼å¼å›¾

4. ç•Œé¢è®¾è®¡
   - æœåŠ¡å™¨ç•Œé¢æˆªå›¾
   - å®¢æˆ·ç«¯ç•Œé¢æˆªå›¾
   - åŠŸèƒ½è¯´æ˜

5. ç¼–è¯‘å’Œè¿è¡Œç¯å¢ƒ
   - Visual Studio 2019/2022
   - Windows 10/11
   - Python 3.8+

6. ç”¨æˆ·ä½¿ç”¨æ–¹æ³•
   - å¯åŠ¨æœåŠ¡å™¨æ­¥éª¤
   - è¿æ¥å®¢æˆ·ç«¯æ­¥éª¤
   - å‘é€å‘½ä»¤æ¼”ç¤º
   - æŸ¥çœ‹æ—¥å¿—æ–¹æ³•

7. æµ‹è¯•ç»“æœ
   - åŠŸèƒ½æµ‹è¯•æˆªå›¾
   - æ€§èƒ½æµ‹è¯•æ•°æ®
   - å¼‚å¸¸å¤„ç†æµ‹è¯•
```

## ğŸ’¡ å¼€å‘å»ºè®®

### 1. å…ˆå®ç°æ§åˆ¶å°ç‰ˆæœ¬

ä¸è¦æ€¥äºå®ç°GUIï¼Œå…ˆå®Œæˆæ§åˆ¶å°ç‰ˆæœ¬çš„å®Œæ•´åŠŸèƒ½ï¼š
- æœåŠ¡å™¨èƒ½æ¥å—è¿æ¥
- å®¢æˆ·ç«¯èƒ½å‘é€å‘½ä»¤
- æœåŠ¡å™¨èƒ½æ­£ç¡®å“åº”
- æ—¥å¿—èƒ½æ­£å¸¸è®°å½•

### 2. é€æ­¥æ·»åŠ åŠŸèƒ½

æŒ‰ä¼˜å…ˆçº§å®ç°åŠŸèƒ½ï¼š
1. åŸºç¡€è¿æ¥å’Œé€šä¿¡
2. å‘½ä»¤å¤„ç†
3. Pythoné›†æˆ
4. GUIç•Œé¢
5. é”™è¯¯å¤„ç†
6. æ€§èƒ½ä¼˜åŒ–

### 3. å……åˆ†æµ‹è¯•

æ¯å®Œæˆä¸€ä¸ªåŠŸèƒ½å°±æµ‹è¯•ï¼š
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- è¾¹ç•Œæµ‹è¯•
- å¼‚å¸¸æµ‹è¯•

### 4. ä¿æŒä»£ç æ•´æ´

- æ·»åŠ æ³¨é‡Š
- ç»Ÿä¸€å‘½åè§„èŒƒ
- åˆç†çš„æ–‡ä»¶ç»„ç»‡
- ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰

## ğŸ¯ æ—¶é—´è§„åˆ’å»ºè®®

å‡è®¾æœ‰2å‘¨æ—¶é—´ï¼š

**ç¬¬1å‘¨**ï¼š
- Day 1-2: å®Œæˆ `FarmClient.cpp` å®ç°
- Day 3-4: å®Œæˆ `PythonBridge` å®ç°
- Day 5-6: æµ‹è¯•åŸºç¡€é€šä¿¡åŠŸèƒ½
- Day 7: ä¿®å¤bugï¼Œå®Œå–„åŠŸèƒ½

**ç¬¬2å‘¨**ï¼š
- Day 8-10: å®ç°GUIç•Œé¢ï¼ˆæœåŠ¡å™¨+å®¢æˆ·ç«¯ï¼‰
- Day 11-12: é›†æˆæµ‹è¯•ï¼Œæ€§èƒ½ä¼˜åŒ–
- Day 13: ç¼–å†™æ–‡æ¡£ï¼Œå‡†å¤‡æ¼”ç¤ºææ–™
- Day 14: æœ€ç»ˆæµ‹è¯•ï¼Œæ‰“åŒ…æäº¤

## â“ å¸¸è§é—®é¢˜

### Q1: ç¼–è¯‘æ—¶æ‰¾ä¸åˆ°ws2_32.lib
**A**: åœ¨é¡¹ç›®å±æ€§ä¸­æ·»åŠ é“¾æ¥åº“ï¼š
```
é¡¹ç›® â†’ å±æ€§ â†’ é“¾æ¥å™¨ â†’ è¾“å…¥ â†’ é™„åŠ ä¾èµ–é¡¹
æ·»åŠ ï¼šws2_32.lib
```

### Q2: Pythoné›†æˆå¤±è´¥
**A**: ç¡®ä¿ï¼š
- Python 3.8+ å·²å®‰è£…
- è®¾ç½®äº†æ­£ç¡®çš„includeå’Œlibè·¯å¾„
- é“¾æ¥äº†Pythonåº“ï¼ˆå¦‚python38.libï¼‰

### Q3: å®¢æˆ·ç«¯è¿æ¥ä¸ä¸ŠæœåŠ¡å™¨
**A**: æ£€æŸ¥ï¼š
- æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨
- ç«¯å£æ˜¯å¦æ­£ç¡®
- é˜²ç«å¢™æ˜¯å¦å…è®¸
- IPåœ°å€æ˜¯å¦æ­£ç¡®

### Q4: å¦‚ä½•è°ƒè¯•ç½‘ç»œé€šä¿¡
**A**: 
- ä½¿ç”¨WiresharkæŠ“åŒ…
- æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- ä½¿ç”¨Visual Studioè°ƒè¯•å™¨
- æ£€æŸ¥è¿”å›å€¼å’Œé”™è¯¯ç 

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ–‡æ¡£**ï¼š
   - `WINSOCK_PROTOCOL.md` - åè®®è¯¦æƒ…
   - `winsock_server/README.md` - æœåŠ¡å™¨æ–‡æ¡£
   - `WINSOCK_PROJECT_SUMMARY.md` - é¡¹ç›®æ€»ç»“

2. **å‚è€ƒä»£ç **ï¼š
   - å·²å®ç°çš„æœåŠ¡å™¨ä»£ç 
   - åè®®å®ç°ä»£ç 
   - ä¸»ç¨‹åºç¤ºä¾‹

3. **åœ¨çº¿èµ„æº**ï¼š
   - Winsockç¼–ç¨‹æ•™ç¨‹
   - Python C APIæ–‡æ¡£
   - MFC/Qtæ•™ç¨‹

## ğŸ‰ æ€»ç»“

é¡¹ç›®çš„æ ¸å¿ƒæ¶æ„å’Œåè®®å·²ç»å®Œæˆï¼Œå‰©ä¸‹çš„å·¥ä½œä¸»è¦æ˜¯ï¼š
1. å®ç°å®¢æˆ·ç«¯é€šä¿¡é€»è¾‘
2. é›†æˆPythonä¸šåŠ¡é€»è¾‘
3. æ·»åŠ GUIç•Œé¢
4. æµ‹è¯•å’Œæ–‡æ¡£

æŒ‰ç…§æœ¬æŒ‡å—çš„æ­¥éª¤ï¼Œåº”è¯¥èƒ½å¤Ÿé¡ºåˆ©å®Œæˆä½œä¸šè¦æ±‚ã€‚åŠ æ²¹ï¼
