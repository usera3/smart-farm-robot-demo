# 🤖 完整自动化农场系统设计文档

## 📋 系统概述

这是一个复杂的多阶段自动化农场管理系统，按 **Y 键**启动。

## 🔄 工作流程

### 阶段1: 自动播种 🌱
- **触发**: Y键启动
- **操作**: 使用贪心算法播种所有空地
- **工具**: 播种器（P键）
- **完成条件**: 所有空地已播种
- **统计**: 已播种数量

### 阶段2: 第一次浇水 💧
- **操作**: 对所有种子进行第一次浇水
- **工具**: 浇水器（5键）
- **范围**: 3.0m 圆形范围
- **注意**: 可能产生杂草，可能有种子不在范围内

### 阶段3: 扫描杂草 🔍
- **操作**: 使用扫描仪检测杂草和害虫
- **工具**: 扫描仪（2键）
- **范围**: 扫描器范围
- **记录**: 
  - 杂草位置列表
  - 害虫植物列表
  - 未浇水种子列表

### 阶段4: 清除杂草 🔫
- **条件**: 如果检测到杂草
- **操作**: 切换到激光，移动到杂草附近
- **工具**: 激光（1键）
- **特性**: 自动瞄准
- **完成**: 所有杂草清除

### 阶段5: 补充浇水 💧
- **对象**: 未浇水的种子
- **避免**: 覆盖已发芽的植物

### 阶段6: 再次扫描 🔍
- **检查**: 新浇水的种子状态
- **判断**: 是否生成新杂草

### 阶段7: 循环检查 🔄
- **条件**: 如果还有未发芽的种子
- **操作**: 返回阶段4
- **终止**: 所有种子已发芽

### 阶段8: 土壤扫描 🧪
- **工具**: 土壤探测器（3键）
- **操作**: 扫描所有植物土壤状态
- **记录**: 土壤数据

### 阶段9: 喷洒农药 🧴
- **条件**: 如果有害虫
- **工具**: 喷雾器（4键）
- **对象**: 有害虫的植物
- **完成**: 所有害虫清除

### 阶段10: 持续浇水 💧
- **对象**: 所有植物
- **目标**: 让植物成熟
- **检查**: growth_stage 达到最大值
- **循环**: 直到所有植物成熟

### 阶段11: 收获 🌾
- **工具**: 机械臂（H键）
- **操作**: 移动到每个成熟植物
- **动作**: 使用机械臂收获
- **完成**: 所有植物已收获

## 🎮 按键绑定

- **T键**: 简单自动播种（只播种）
- **Y键**: 完整自动化流程（全流程）

## 📊 状态管理

```javascript
autoFarmState = {
    isRunning: false,
    currentPhase: '',
    seeds: [],      // 种子列表
    weeds: [],      // 杂草位置
    pests: [],      // 害虫植物
    watered: [],    // 已浇水
    mature: [],     // 成熟植物
    stats: {
        planted: 0,
        weeds_removed: 0,
        watered: 0,
        pests_sprayed: 0,
        harvested: 0
    }
}
```

## 🛠️ 工具说明

| 工具 | 按键 | 用途 | 范围 |
|------|------|------|------|
| 激光 | 1 | 除杂草 | 自动瞄准 |
| 扫描仪 | 2 | 检测杂草/害虫 | 扫描范围 |
| 土壤探测 | 3 | 检测土壤 | 接触 |
| 喷雾器 | 4 | 杀虫 | 锥形范围 |
| 浇水器 | 5 | 浇水 | 3.0m圆形 |
| 播种器 | P | 播种 | 当前位置 |
| 机械臂 | H | 收获 | 接触 |

## ⚠️ 注意事项

1. **杂草机制**: 每次浇水可能产生杂草
2. **范围限制**: 浇水器范围有限，可能需要多次覆盖
3. **害虫**: 植物可能被害虫侵蚀
4. **成熟时间**: 需要多次浇水才能成熟
5. **自动瞄准**: 激光会自动瞄准最近的杂草

## 🔧 技术实现

### 核心函数

- `startFullAutoFarm()` - 启动完整流程
- `phaseAutomatic()` - 阶段控制器
- `phasePlanting()` - 播种阶段
- `phaseFirstWater()` - 首次浇水
- `phaseScanWeeds()` - 扫描杂草
- `phaseRemoveWeeds()` - 清除杂草
- `phaseWaterRemaining()` - 补充浇水
- `phaseLoopCheck()` - 循环检查
- `phaseFinalScan()` - 最终扫描
- `phaseSprayPests()` - 喷洒农药
- `phaseWaterGrowth()` - 持续浇水
- `phaseHarvest()` - 收获
- `phaseComplete()` - 完成

### 辅助函数

- `switchEquipmentAuto(tool)` - 自动切换工具
- `moveToPlantAuto(plant)` - 移动到植物
- `waitForAction(duration)` - 等待操作完成
- `scanArea()` - 扫描区域
- `useToolAuto()` - 自动使用当前工具

## 📈 预期效果

完整流程大约需要 **5-10 分钟**，取决于：
- 农田大小（64块地）
- 杂草生成概率
- 害虫数量
- 植物成熟速度

## 🚀 启动方式

```
按 Y 键 → 观察自动化流程 → 等待完成
```

控制台会显示详细的日志信息，追踪每个阶段的进度。





