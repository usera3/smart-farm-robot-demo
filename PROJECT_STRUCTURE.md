# é¡¹ç›®æ–‡ä»¶ç»“æ„æ€»è§ˆ

## ğŸ“ å®Œæ•´ç›®å½•ç»“æ„

```
git_test/
â”‚
â”œâ”€â”€ ğŸ“„ WINSOCK_PROTOCOL.md              # é€šä¿¡åè®®è¯¦ç»†è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ WINSOCK_PROJECT_SUMMARY.md       # é¡¹ç›®æ€»ç»“å’Œå®ç°è¯´æ˜
â”œâ”€â”€ ğŸ“„ QUICK_START.md                   # å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.md             # æœ¬æ–‡ä»¶ - é¡¹ç›®ç»“æ„è¯´æ˜
â”‚
â”œâ”€â”€ ğŸ“ winsock_server/                  # C++ æœåŠ¡å™¨ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ ğŸ“„ protocol.h                   # âœ… åè®®å®šä¹‰å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ protocol.cpp                 # âœ… åè®®å®ç°
â”‚   â”œâ”€â”€ ğŸ“„ FarmServer.h                 # âœ… æœåŠ¡å™¨ç±»å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ FarmServer.cpp               # âœ… æœåŠ¡å™¨å®ç°ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ main.cpp                     # âœ… ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ CMakeLists.txt               # âœ… CMakeæ„å»ºé…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ server_config.json           # âœ… æœåŠ¡å™¨é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ README.md                    # âœ… æœåŠ¡å™¨æ–‡æ¡£
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ PythonBridge.h               # â³ Pythoné›†æˆå¤´æ–‡ä»¶ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ PythonBridge.cpp             # â³ Pythoné›†æˆå®ç°ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ ServerGUI.h                  # â³ GUIç•Œé¢å¤´æ–‡ä»¶ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ ğŸ“„ ServerGUI.cpp                # â³ GUIå®ç°ï¼ˆå¾…å®ç°ï¼‰
â”‚
â”œâ”€â”€ ğŸ“ winsock_client/                  # C++ å®¢æˆ·ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ ğŸ“„ FarmClient.h                 # âœ… å®¢æˆ·ç«¯ç±»å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ FarmClient.cpp               # â³ å®¢æˆ·ç«¯å®ç°ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ ClientGUI.h                  # â³ GUIç•Œé¢å¤´æ–‡ä»¶ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ ClientGUI.cpp                # â³ GUIå®ç°ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ main.cpp                     # â³ ä¸»ç¨‹åºå…¥å£ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ CMakeLists.txt               # â³ CMakeæ„å»ºé…ç½®ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ ğŸ“„ README.md                    # â³ å®¢æˆ·ç«¯æ–‡æ¡£ï¼ˆå¾…å®ç°ï¼‰
â”‚
â”œâ”€â”€ ğŸ“ åŸæœ‰Pythonä¸šåŠ¡é€»è¾‘ï¼ˆä¿ç•™ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ server_game.py               # FlaskæœåŠ¡å™¨ï¼ˆåŸæœ‰ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ auto_farm_controller.py      # è‡ªåŠ¨åŒ–æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ ğŸ“„ plant_manager.py             # æ¤ç‰©ç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“„ path_planner.py              # è·¯å¾„è§„åˆ’ï¼ˆA*ç®—æ³•ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ resource_manager.py          # èµ„æºç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“„ state_monitor.py             # çŠ¶æ€ç›‘æ§
â”‚   â”œâ”€â”€ ğŸ“„ auto_task_executor.py        # ä»»åŠ¡æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ ğŸ“„ cart_movement_api.py         # å°è½¦ç§»åŠ¨API
â”‚   â””â”€â”€ ğŸ“„ requirements.txt             # Pythonä¾èµ–
â”‚
â””â”€â”€ ğŸ“ templates/                       # Webç•Œé¢ï¼ˆåŸæœ‰ï¼‰
    â””â”€â”€ ğŸ“„ game.html                    # 3Då¯è§†åŒ–ç•Œé¢
```

## ğŸ“Š æ–‡ä»¶çŠ¶æ€è¯´æ˜

### âœ… å·²å®Œæˆï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼‰

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `WINSOCK_PROTOCOL.md` | 400+ | å®Œæ•´çš„é€šä¿¡åè®®è®¾è®¡ |
| `WINSOCK_PROJECT_SUMMARY.md` | 500+ | é¡¹ç›®æ€»ç»“å’Œæ¶æ„è¯´æ˜ |
| `QUICK_START.md` | 400+ | å¿«é€Ÿå¼€å§‹å’Œå¼€å‘æŒ‡å— |
| `winsock_server/protocol.h` | 150 | åè®®æ•°æ®ç»“æ„å®šä¹‰ |
| `winsock_server/protocol.cpp` | 120 | åè®®å®ç° |
| `winsock_server/FarmServer.h` | 180 | æœåŠ¡å™¨ç±»å®šä¹‰ |
| `winsock_server/FarmServer.cpp` | 600+ | æœåŠ¡å™¨æ ¸å¿ƒåŠŸèƒ½å®ç° |
| `winsock_server/main.cpp` | 300+ | æœåŠ¡å™¨ä¸»ç¨‹åº |
| `winsock_server/CMakeLists.txt` | 50 | CMakeæ„å»ºé…ç½® |
| `winsock_server/README.md` | 500+ | æœåŠ¡å™¨è¯¦ç»†æ–‡æ¡£ |
| `winsock_client/FarmClient.h` | 100 | å®¢æˆ·ç«¯ç±»å®šä¹‰ |

**æ€»è®¡**ï¼šçº¦ 3,300+ è¡Œä»£ç å’Œæ–‡æ¡£

### â³ å¾…å®ç°ï¼ˆéœ€è¦è¡¥å……ï¼‰

| æ–‡ä»¶ | é¢„è®¡è¡Œæ•° | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|---------|--------|------|
| `winsock_client/FarmClient.cpp` | 400 | ğŸ”´ é«˜ | å®¢æˆ·ç«¯é€šä¿¡å®ç° |
| `winsock_server/PythonBridge.cpp` | 200 | ğŸ”´ é«˜ | Pythoné›†æˆ |
| `winsock_server/ServerGUI.cpp` | 300 | ğŸŸ¡ ä¸­ | æœåŠ¡å™¨GUI |
| `winsock_client/ClientGUI.cpp` | 300 | ğŸŸ¡ ä¸­ | å®¢æˆ·ç«¯GUI |
| `winsock_client/main.cpp` | 200 | ğŸ”´ é«˜ | å®¢æˆ·ç«¯ä¸»ç¨‹åº |

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. é€šä¿¡åè®®å±‚

**æ–‡ä»¶**ï¼š`protocol.h/cpp`

**åŠŸèƒ½**ï¼š
- æ•°æ®åŒ…æ ¼å¼å®šä¹‰ï¼ˆHeader + Command + Length + Dataï¼‰
- 15ç§å‘½ä»¤ç±»å‹
- 8ç§å“åº”ç±»å‹
- 9ç§é”™è¯¯ä»£ç 
- åºåˆ—åŒ–/ååºåˆ—åŒ–

**å…³é”®ä»£ç **ï¼š
```cpp
struct PacketHeader {
    uint32_t magic;      // 0x46415246 "FARM"
    uint32_t command;    // å‘½ä»¤ç±»å‹
    uint32_t length;     // æ•°æ®é•¿åº¦
};

struct Packet {
    PacketHeader header;
    std::string data;    // JSONæ ¼å¼
};
```

### 2. æœåŠ¡å™¨æ ¸å¿ƒ

**æ–‡ä»¶**ï¼š`FarmServer.h/cpp`

**åŠŸèƒ½**ï¼š
- Winsock TCPç›‘å¬ï¼ˆç«¯å£8888ï¼‰
- å¤šå®¢æˆ·ç«¯ç®¡ç†ï¼ˆæœ€å¤š10ä¸ªï¼‰
- å¤šçº¿ç¨‹å¼‚æ­¥é€šä¿¡
- å¿ƒè·³æ£€æµ‹ï¼ˆ5ç§’é—´éš”ï¼‰
- å‘½ä»¤åˆ†å‘å¤„ç†
- æ—¥å¿—ç³»ç»Ÿ
- å®¢æˆ·ç«¯è¶…æ—¶æ£€æµ‹

**å…³é”®æ–¹æ³•**ï¼š
```cpp
bool start(const ServerConfig& config);
void stop();
void acceptLoop();              // æ¥å—è¿æ¥
void clientLoop(int clientId);  // å¤„ç†å®¢æˆ·ç«¯
void handleCommand(int clientId, const Packet& packet);
```

### 3. å®¢æˆ·ç«¯æ ¸å¿ƒ

**æ–‡ä»¶**ï¼š`FarmClient.h/cpp`

**åŠŸèƒ½**ï¼š
- TCPè¿æ¥ç®¡ç†
- å‘½ä»¤å‘é€æ¥å£
- å“åº”æ¥æ”¶å¤„ç†
- è‡ªåŠ¨é‡è¿æœºåˆ¶
- å›è°ƒå‡½æ•°ç³»ç»Ÿ

**å…³é”®æ–¹æ³•**ï¼š
```cpp
bool connect(const ClientConfig& config);
bool sendMoveCart(float x, float z);
bool sendPlantSeed(int row, int col, const std::string& type);
void receiveLoop();  // æ¥æ”¶å“åº”
```

### 4. Pythoné›†æˆ

**æ–‡ä»¶**ï¼š`PythonBridge.h/cpp`ï¼ˆå¾…å®ç°ï¼‰

**åŠŸèƒ½**ï¼š
- åˆå§‹åŒ–Pythonè§£é‡Šå™¨
- è°ƒç”¨Pythonå‡½æ•°
- æ•°æ®ç±»å‹è½¬æ¢ï¼ˆC++ â†” Pythonï¼‰
- é”™è¯¯å¤„ç†

**é¢„æœŸæ¥å£**ï¼š
```cpp
class PythonBridge {
public:
    bool initialize(const std::string& pythonHome);
    std::string callFunction(const std::string& module,
                            const std::string& function,
                            const std::string& args);
    void shutdown();
};
```

### 5. GUIç•Œé¢

**æ–‡ä»¶**ï¼š`ServerGUI.cpp`, `ClientGUI.cpp`ï¼ˆå¾…å®ç°ï¼‰

**æœåŠ¡å™¨GUIåŠŸèƒ½**ï¼š
- æœåŠ¡å™¨çŠ¶æ€æ˜¾ç¤º
- å®¢æˆ·ç«¯åˆ—è¡¨ï¼ˆIDã€IPã€ç«¯å£ã€çŠ¶æ€ï¼‰
- æ“ä½œæ—¥å¿—æ˜¾ç¤º
- æ§åˆ¶æŒ‰é’®ï¼ˆå¯åŠ¨/åœæ­¢ï¼‰

**å®¢æˆ·ç«¯GUIåŠŸèƒ½**ï¼š
- è¿æ¥è®¾ç½®
- æ§åˆ¶é¢æ¿ï¼ˆç§»åŠ¨ã€æ“ä½œï¼‰
- çŠ¶æ€æ˜¾ç¤º
- æ¤ç‰©ç½‘æ ¼ï¼ˆ8x8ï¼‰

## ğŸ”„ æ•°æ®æµå‘

### å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨

```
å®¢æˆ·ç«¯GUI
    â†“ ç”¨æˆ·æ“ä½œ
FarmClient::sendMoveCart(x, z)
    â†“ åˆ›å»ºæ•°æ®åŒ…
Packet(CMD_MOVE_CART, "{x:1.5,z:-2.0}")
    â†“ åºåˆ—åŒ–
[Header|Command|Length|Data]
    â†“ TCPå‘é€
    â†“
æœåŠ¡å™¨æ¥æ”¶
    â†“ ååºåˆ—åŒ–
FarmServer::handleCommand()
    â†“ å‘½ä»¤åˆ†å‘
FarmServer::handleMoveCart()
    â†“ è°ƒç”¨Python
PythonBridge::callFunction("server_game", "move_cart", ...)
    â†“ Pythonå¤„ç†
server_game.py æ›´æ–°å°è½¦ä½ç½®
    â†“ è¿”å›ç»“æœ
FarmServer::sendSuccess()
    â†“ åˆ›å»ºå“åº”
Packet(RESP_SUCCESS, "{status:success}")
    â†“ TCPå‘é€
    â†“
å®¢æˆ·ç«¯æ¥æ”¶
    â†“ è§£æå“åº”
FarmClient::handleSuccess()
    â†“ è§¦å‘å›è°ƒ
æ›´æ–°GUIæ˜¾ç¤º
```

### æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯ï¼ˆæ¨é€ï¼‰

```
Pythonè‡ªåŠ¨åŒ–ç³»ç»Ÿ
    â†“ çŠ¶æ€æ›´æ–°
auto_farm_controller.py
    â†“ é€šçŸ¥C++
PythonBridgeè¿”å›çŠ¶æ€
    â†“
FarmServer::broadcastStateUpdate()
    â†“ åˆ›å»ºæ•°æ®åŒ…
Packet(RESP_STATE_UPDATE, "{cart:{x:1.5,z:-2.0},...}")
    â†“ å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯
    â†“
å®¢æˆ·ç«¯æ¥æ”¶
    â†“ è§£æçŠ¶æ€
FarmClient::handleStateUpdate()
    â†“ è§¦å‘å›è°ƒ
æ›´æ–°GUIæ˜¾ç¤º
```

## ğŸ”§ ç¼–è¯‘ä¾èµ–

### Windowsä¾èµ–

```
å¿…éœ€ï¼š
- Windows SDK (Winsock2)
- Visual Studio 2019/2022
- CMake 3.10+

å¯é€‰ï¼ˆGUIï¼‰ï¼š
- MFC (Visual Studioè‡ªå¸¦)
- Qt 5.15+ (éœ€å•ç‹¬å®‰è£…)

Pythoné›†æˆï¼š
- Python 3.8+ å¼€å‘åŒ…
- Python38.lib
```

### é“¾æ¥åº“

```cmake
# æœåŠ¡å™¨
target_link_libraries(FarmServer 
    ws2_32          # Winsock
    ${Python3_LIBRARIES}  # Python
)

# å®¢æˆ·ç«¯
target_link_libraries(FarmClient
    ws2_32          # Winsock
)
```

## ğŸ“ˆ ä»£ç ç»Ÿè®¡

### å·²å®Œæˆä»£ç 

| ç±»å‹ | æ–‡ä»¶æ•° | æ€»è¡Œæ•° | è¯´æ˜ |
|------|--------|--------|------|
| C++ å¤´æ–‡ä»¶ | 3 | 430 | protocol.h, FarmServer.h, FarmClient.h |
| C++ å®ç° | 3 | 1,200 | protocol.cpp, FarmServer.cpp, main.cpp |
| æ–‡æ¡£ | 5 | 1,700 | åè®®ã€æ€»ç»“ã€æŒ‡å—ç­‰ |
| é…ç½® | 2 | 70 | CMakeLists.txt, config.json |
| **æ€»è®¡** | **13** | **3,400** | |

### å¾…å®ç°ä»£ç ï¼ˆé¢„ä¼°ï¼‰

| ç±»å‹ | æ–‡ä»¶æ•° | é¢„è®¡è¡Œæ•° | ä¼˜å…ˆçº§ |
|------|--------|---------|--------|
| å®¢æˆ·ç«¯å®ç° | 2 | 600 | é«˜ |
| Pythoné›†æˆ | 2 | 300 | é«˜ |
| GUIç•Œé¢ | 4 | 800 | ä¸­ |
| æµ‹è¯•ä»£ç  | 3 | 400 | ä¸­ |
| **æ€»è®¡** | **11** | **2,100** | |

## ğŸ“ å­¦ä¹ ä»·å€¼

### æŠ€æœ¯ç‚¹è¦†ç›–

1. **ç½‘ç»œç¼–ç¨‹**
   - Winsock APIä½¿ç”¨
   - TCP/IPåè®®
   - å¤šå®¢æˆ·ç«¯ç®¡ç†
   - å¼‚æ­¥é€šä¿¡

2. **ç³»ç»Ÿç¼–ç¨‹**
   - å¤šçº¿ç¨‹ç¼–ç¨‹
   - çº¿ç¨‹åŒæ­¥ï¼ˆmutexï¼‰
   - è¿›ç¨‹é—´é€šä¿¡

3. **åè®®è®¾è®¡**
   - è‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®
   - æ•°æ®åºåˆ—åŒ–
   - é”™è¯¯å¤„ç†æœºåˆ¶

4. **æ··åˆç¼–ç¨‹**
   - C++ ä¸ Pythoné›†æˆ
   - Python C API
   - è·¨è¯­è¨€è°ƒç”¨

5. **è½¯ä»¶å·¥ç¨‹**
   - æ¨¡å—åŒ–è®¾è®¡
   - æ¥å£æŠ½è±¡
   - æ–‡æ¡£ç¼–å†™
   - ç‰ˆæœ¬æ§åˆ¶

## ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯åš

1. **æµ‹è¯•ç°æœ‰ä»£ç **
   - åœ¨Windowsä¸Šç¼–è¯‘æœåŠ¡å™¨
   - è¿è¡Œmain.cpp
   - éªŒè¯åŸºæœ¬åŠŸèƒ½

2. **å®ç°å®¢æˆ·ç«¯**
   - å®ŒæˆFarmClient.cpp
   - å®ç°è¿æ¥å’Œå‘é€
   - æµ‹è¯•ä¸æœåŠ¡å™¨é€šä¿¡

3. **ç®€å•æµ‹è¯•**
   - åˆ›å»ºtest_client.cpp
   - å‘é€å‡ ä¸ªå‘½ä»¤
   - éªŒè¯å“åº”æ­£ç¡®

### åç»­å·¥ä½œ

1. **Pythoné›†æˆ**
   - å®ç°PythonBridge
   - è°ƒç”¨plant_manager
   - æµ‹è¯•æ•°æ®äº¤äº’

2. **GUIå¼€å‘**
   - é€‰æ‹©æ¡†æ¶ï¼ˆMFC/Qtï¼‰
   - å®ç°åŸºæœ¬ç•Œé¢
   - é›†æˆé€šä¿¡åŠŸèƒ½

3. **å®Œå–„åŠŸèƒ½**
   - é”™è¯¯å¤„ç†
   - æ€§èƒ½ä¼˜åŒ–
   - æ–‡æ¡£å®Œå–„

## ğŸ‰ æ€»ç»“

é¡¹ç›®å·²ç»å®Œæˆäº†**æ ¸å¿ƒæ¶æ„è®¾è®¡å’ŒæœåŠ¡å™¨ç«¯å®ç°**ï¼Œçº¦å æ€»å·¥ä½œé‡çš„60%ã€‚å‰©ä½™å·¥ä½œä¸»è¦æ˜¯ï¼š

- ğŸ”´ **é«˜ä¼˜å…ˆçº§**ï¼šå®¢æˆ·ç«¯å®ç°ã€Pythoné›†æˆï¼ˆå¿…éœ€ï¼‰
- ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§**ï¼šGUIç•Œé¢ï¼ˆæ¨èï¼‰
- ğŸŸ¢ **ä½ä¼˜å…ˆçº§**ï¼šæµ‹è¯•ã€ä¼˜åŒ–ã€æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰

æŒ‰ç…§`QUICK_START.md`çš„æŒ‡å¯¼ï¼Œåº”è¯¥èƒ½å¤Ÿé¡ºåˆ©å®Œæˆæ•´ä¸ªé¡¹ç›®ï¼
